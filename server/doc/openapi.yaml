openapi: 3.0.4
info:
  title: PhotoSync API
  description: API for uploading, editing and accessing photos.
  version: 0.2.0
  contact:
    name: Mateusz PiÄ™tka
    email: matipietka@gmail.com
servers:
  - url: /v1
    description: locally deployed server
paths:
  /login:
    post:
      summary: logins user into API
      requestBody:
        description: user credentials
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCredentials"
      responses:
        "200":
          description: user successfully logged in
          content:
            text/plain:
              schema:
                $ref: "#/components/schemas/JWT"
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
        "400":
          description: invalid request
        "401":
          description: user does not exist or invalid password was given
        "500":
          description: server error

  /register:
    post:
      summary: registers user on the server
      requestBody:
        description: user credentials
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCredentials"
      responses:
        "200":
          description: user successfully registered
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
        "400":
          description: invalid request
        "401":
          description: user already exists
        "500":
          description: server error

  /upload:
    post:
      summary: uploads a photo to a server
      security:
        - tokenAuth: []
      requestBody:
        description: contains the filename and modification date from the client's file system and the file itself
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                filename:
                  type: string
                  description: name of the file
                  example: cat.jpg
                modification_date:
                  type: string
                  description: timestamp from the client filesystem, it will be used when the file lacks metadata indicating its creation time
                  example: "2025.05.16 12:30:45"
                file:
                  type: string
                  description: |
                    image or video <br>
                    following MIMETypes are supported:
                      - image/jpeg
                  format: binary
            encoding:
              file:
                contentType: image/jpeg
      responses:
        "200":
          description: file was successfully uploaded
          content:
            text/plain:
              schema:
                type: integer
                description: id of the photo
                example: 102
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
        "400":
          description: invalid request
        "401":
          description: file is unsupported
        "402":
          description: file already exists
        "403":
          description: token expired or is invalid
        "500":
          description: server error
    options:
      summary: used by web browser during preflight to determine for what API allows
      responses:
        "200":
          description: "allows web browser for CORS request"
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
            Access-Control-Allow-Headers:
              schema:
                type: string
                example: "Authorization"
              description: allows web browser to include 'Authorization' header
            Access-Control-Allow-Methods:
              schema:
                type: string
                example: "POST"
              description: allows web browser for POST request
  /file_data:
    get:
      summary: |
        Returns list of metadata.
        List is sorted by creation date in descending order.
      security:
        - tokenAuth: []
      parameters:
        - in: query
          name: date
          schema:
            type: string
            description: |
              Date formated as 'DD.MM.YYYY'.
              Only data of files created on given date will be returned.
            example: '16.05.2025'
          required: true
      responses:
        "200":
          description: returned file metadata
          content:
            application/json:
              schema:
                description: metadata of the files
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: 102
                    filename:
                      type: string
                      example: cute_dog.jpg
                    creation_date:
                      type: string
                      example: "2025.05.16 16:45:00"
                    mime_type:
                      type: string
                      example: "image/jpeg"
                    size:
                      type: string
                      description: size of the file in bytes
                      example: "2520424"
                    thumbnail:
                      type: string
                      description: |
                        Base64 encoded image/jpeg.
                        Orginal image/jpeg is used as a thumbnail when its not bigger than 600px x 600px.
                        Thumbnail size can range from 400px x 400px to 600px x 600px.
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
        "400":
          description: bad request
        "403":
          description: missing or invalid token
        "500":
          description: server error
    options:
      summary: used by web browser during preflight to determine for what API allows
      responses:
        "200":
          description: "allows web browser for CORS request"
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
            Access-Control-Allow-Headers:
              schema:
                type: string
                example: "Authorization"
              description: allows web browser to include 'Authorization' header
            Access-Control-Allow-Methods:
              schema:
                type: string
                example: "GET"
              description: allows web browser for GET request
  /dates:
    get:
      summary: Returns the dates along with the number of files created on each. Only dates with at least one file are included
      security:
        - tokenAuth: []
      parameters:
        - in: query
          name: year
          schema:
            type: integer
            description: Year from which to return dates
            example: 2012
          required: false
        - in: query
          name: month
          schema:
            type: integer
            description: Month of the year from which to return dates, year must be specified.
            example: 10
          required: false
      responses:
        "200":
          description: successfully returned dates
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    date:
                      type: string
                      example: 2025.05.16
                    file_count:
                      type: string
                      example: 23
  /file:
    get:
      summary: returns file with given id
      security:
        - tokenAuth: []
      parameters:
        - in: query
          name: id
          schema:
            type: integer
            description: id of wanted file
            example: 102
          required: true
      responses:
        "200":
          description: file successfully returned
          content:
            image/jpeg:
              schema:
                type: string
                description: file
                format: binary
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
        "400":
          description: bad request
        "403":
          description: missing or invalid token
        "404":
          description: file with given id not found
        "500":
          description: server error
    delete:
      summary: removes file with given id
      security:
        - tokenAuth: []
      parameters:
        - in: query
          name: id
          schema:
            type: integer
            description: id of wanted file
            example: 102
          required: true
      responses:
        "200":
          description: file successfully removed
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
        "400":
          description: bad request
        "403":
          description: missing or invalid token
        "404":
          description: file with given id not found
        "500":
          description: server error
    options:
      summary: used by web browser during preflight to determine for what API allows
      responses:
        "200":
          description: "allows web browser for CORS request"
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
            Access-Control-Allow-Headers:
              schema:
                type: string
                example: "Authorization"
              description: allows web browser to include 'Authorization' header
            Access-Control-Allow-Methods:
              schema:
                type: string
                example: "GET, DELETE"
              description: allows web browser for GET and DELETE requests
  /restart:
    post:
      summary: |
        Clears entire database.
        This endpoint is used only for testing purposes.
        It can be enabled with '--testing' flag.
      responses:
        "200":
          description: "database got successfully cleared"
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
                example: "'*', 'http://localhost:3200'"
              description: allows web browser to share response with given origin
        "500":
          description: "failed to clear database"
components:
  schemas:
    UserCredentials:
      type: object
      properties:
        username:
          type: string
          example: username
        password:
          type: string
          example: password
    JWT:
      type: string
      description: |
        Token returned by /login endpoint. <br>
        It contains:
         1. user_id
         2. username
         3. expiration_time
      example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHBpcmF0aW9uX3RpbWUiOiIxNzU0NDAwNDQ4IiwidXNlcl9pZCI6IjEiLCJ1c2VybmFtZSI6InVzZXIxMjMifQ.mhu0xDAodyBNiGMyw2EkmT3ZMfq24EkV5o3RDZnN4Sg
  securitySchemes:
    tokenAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT